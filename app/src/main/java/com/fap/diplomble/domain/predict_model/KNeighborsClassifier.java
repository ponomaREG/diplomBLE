package com.fap.diplomble.domain.predict_model;

import java.util.*;


public class KNeighborsClassifier extends AbstractPredictedModel<Integer> {

    public static KNeighborsClassifier get() {
        double[][] X = {{-66, -69, -69, -53}, {-78, -71, -64, -68}, {-76, -67, -69, -66}, {-69, -64, -66, -78}, {-66, -67, -66, -52}, {-66, -63, -70, -92}, {-68, -51, -68, -74}, {-69, -68, -65, -52}, {-68, -64, -62, -70}, {-67, -71, -65, -74}, {-64, -65, -90, -50}, {-66, -79, -82, -89}, {-64, -64, -86, -49}, {-70, -76, -81, -87}, {-72, -64, -63, -72}, {-71, -62, -59, -59}, {-76, -62, -79, -66}, {-67, -63, -70, -70}, {-66, -68, -66, -52}, {-64, -64, -92, -50}, {-71, -74, -84, -62}, {-67, -82, -79, -82}, {-67, -66, -73, -69}, {-65, -64, -67, -79}, {-65, -50, -72, -75}, {-64, -50, -73, -73}, {-63, -65, -90, -49}, {-66, -63, -70, -65}, {-66, -50, -72, -72}, {-64, -68, -71, -67}, {-69, -63, -62, -75}, {-66, -68, -73, -71}, {-64, -65, -88, -50}, {-70, -61, -71, -68}, {-89, -70, -51, -78}, {-65, -51, -74, -70}, {-66, -51, -67, -75}, {-72, -64, -71, -64}, {-68, -66, -73, -71}, {-71, -63, -70, -65}, {-82, -70, -61, -75}, {-67, -64, -70, -89}, {-68, -76, -83, -84}, {-67, -50, -72, -70}, {-71, -76, -67, -68}, {-69, -64, -69, -65}, {-70, -76, -80, -89}, {-65, -68, -71, -68}, {-69, -62, -70, -69}, {-71, -72, -77, -62}, {-82, -72, -56, -75}, {-65, -68, -71, -71}, {-65, -79, -78, -84}, {-71, -63, -77, -59}, {-64, -68, -71, -68}, {-67, -62, -70, -64}, {-65, -67, -68, -52}, {-84, -62, -71, -67}, {-65, -49, -73, -73}, {-73, -64, -77, -63}, {-73, -66, -68, -66}, {-67, -51, -69, -74}, {-71, -62, -71, -68}, {-82, -70, -56, -76}, {-71, -64, -67, -67}, {-65, -66, -73, -71}, {-66, -64, -69, -91}, {-64, -50, -72, -69}, {-66, -66, -74, -69}, {-75, -67, -74, -67}, {-67, -80, -80, -85}, {-63, -66, -91, -50}, {-68, -65, -70, -90}, {-82, -69, -56, -74}, {-64, -67, -64, -71}, {-70, -65, -62, -66}, {-65, -51, -75, -67}, {-68, -82, -81, -82}, {-68, -62, -70, -93}, {-70, -62, -59, -58}, {-65, -70, -64, -71}, {-83, -70, -56, -75}, {-64, -51, -75, -69}, {-68, -64, -72, -71}, {-68, -50, -73, -72}, {-67, -51, -70, -74}, {-73, -70, -65, -67}, {-68, -80, -81, -86}, {-67, -66, -76, -69}, {-86, -68, -53, -78}, {-65, -51, -71, -68}, {-83, -70, -66, -75}, {-84, -70, -57, -74}, {-67, -79, -80, -84}, {-68, -67, -71, -68}, {-70, -64, -78, -60}, {-64, -51, -77, -68}, {-65, -66, -88, -49}, {-69, -64, -68, -81}, {-66, -63, -67, -94}, {-65, -68, -73, -67}, {-68, -68, -64, -52}, {-65, -67, -73, -69}, {-69, -62, -70, -64}, {-68, -71, -69, -53}, {-91, -71, -51, -75}, {-70, -65, -63, -65}, {-85, -68, -53, -78}, {-66, -51, -71, -70}, {-66, -82, -82, -82}, {-67, -63, -69, -86}, {-68, -69, -65, -51}, {-70, -64, -62, -66}, {-66, -64, -67, -83}, {-89, -69, -50, -80}, {-69, -67, -71, -68}, {-71, -65, -62, -66}, {-66, -69, -71, -68}, {-69, -62, -77, -65}, {-70, -74, -67, -69}, {-66, -66, -71, -67}, {-68, -66, -70, -66}, {-63, -78, -80, -90}, {-73, -62, -76, -56}, {-70, -81, -81, -65}, {-74, -75, -78, -62}, {-63, -50, -75, -69}, {-72, -62, -79, -58}, {-73, -61, -73, -66}, {-67, -70, -63, -75}, {-62, -50, -77, -68}, {-68, -51, -69, -74}, {-71, -65, -63, -64}, {-84, -69, -53, -79}, {-68, -62, -73, -69}, {-71, -62, -75, -58}, {-66, -65, -70, -68}, {-65, -69, -66, -75}, {-75, -69, -66, -69}, {-64, -64, -92, -50}, {-66, -77, -83, -89}, {-74, -70, -77, -62}, {-67, -50, -74, -70}, {-71, -67, -65, -66}, {-69, -70, -65, -52}, {-72, -69, -81, -63}, {-82, -69, -56, -76}, {-83, -70, -60, -75}, {-65, -67, -70, -68}, {-81, -62, -74, -68}, {-65, -62, -77, -66}, {-70, -62, -78, -58}, {-68, -63, -62, -70}, {-72, -62, -70, -70}, {-82, -68, -53, -77}, {-64, -65, -74, -67}, {-71, -75, -68, -68}, {-67, -66, -67, -54}, {-74, -71, -78, -63}, {-69, -50, -72, -72}, {-65, -76, -78, -94}, {-68, -70, -65, -52}, {-68, -81, -82, -86}, {-72, -75, -78, -62}, {-68, -63, -66, -80}, {-67, -67, -66, -52}, {-82, -70, -65, -74}, {-73, -68, -76, -64}, {-72, -76, -85, -97}, {-70, -61, -59, -58}, {-67, -68, -67, -51}, {-70, -63, -62, -74}, {-74, -68, -83, -63}, {-65, -78, -80, -93}, {-70, -64, -63, -69}, {-71, -73, -80, -60}, {-67, -67, -68, -52}, {-66, -64, -67, -91}, {-71, -62, -60, -57}, {-68, -76, -78, -90}, {-67, -66, -69, -69}, {-53, -66, -66, -52}, {-71, -78, -80, -86}, {-70, -69, -80, -61}, {-72, -68, -82, -64}, {-66, -51, -69, -74}, {-73, -71, -76, -62}, {-69, -82, -83, -84}, {-68, -70, -69, -67}, {-71, -63, -61, -66}, {-83, -71, -56, -74}, {-75, -76, -83, -68}, {-71, -63, -64, -69}, {-73, -66, -65, -66}, {-67, -67, -74, -70}, {-64, -68, -70, -73}, {-53, -67, -67, -53}, {-68, -70, -70, -53}, {-66, -85, -80, -88}, {-67, -78, -80, -83}, {-68, -67, -73, -69}, {-64, -68, -72, -68}, {-68, -68, -72, -68}, {-63, -64, -71, -68}, {-68, -64, -67, -78}, {-99, -71, -52, -74}, {-71, -73, -85, -60}, {-84, -70, -58, -75}, {-65, -51, -71, -68}, {-67, -76, -81, -91}, {-68, -66, -72, -68}, {-68, -63, -66, -80}, {-68, -64, -69, -100}, {-67, -66, -63, -72}, {-72, -71, -80, -62}, {-81, -62, -72, -66}, {-64, -66, -83, -50}, {-74, -69, -78, -63}, {-70, -64, -64, -70}, {-84, -68, -52, -77}, {-67, -64, -66, -78}, {-68, -50, -71, -70}, {-67, -64, -69, -86}, {-69, -65, -61, -65}, {-73, -71, -83, -63}, {-83, -68, -54, -76}, {-73, -71, -85, -61}, {-82, -69, -56, -74}, {-83, -70, -56, -74}, {-75, -76, -85, -68}, {-64, -49, -73, -73}, {-68, -63, -68, -91}, {-68, -69, -67, -53}, {-69, -65, -63, -75}, {-66, -64, -69, -81}, {-72, -63, -62, -74}, {-65, -64, -67, -76}, {-67, -67, -66, -52}, {-69, -62, -60, -58}, {-66, -64, -66, -80}, {-67, -67, -69, -54}, {-67, -68, -69, -52}, {-67, -67, -73, -67}, {-74, -63, -63, -75}, {-66, -68, -74, -67}, {-65, -60, -75, -65}, {-67, -70, -63, -75}, {-67, -63, -69, -91}, {-75, -68, -77, -64}, {-67, -80, -80, -87}, {-64, -78, -82, -89}, {-63, -50, -71, -76}, {-67, -70, -65, -74}, {-74, -71, -81, -61}, {-62, -65, -80, -49}, {-83, -71, -57, -74}, {-69, -64, -69, -65}, {-74, -73, -86, -61}, {-72, -75, -84, -94}, {-72, -64, -62, -73}, {-65, -67, -74, -70}, {-67, -63, -67, -99}, {-70, -75, -85, -88}, {-67, -67, -72, -68}, {-73, -70, -78, -61}, {-66, -78, -78, -84}, {-66, -64, -67, -91}, {-67, -63, -68, -91}, {-65, -81, -81, -85}, {-65, -68, -76, -70}, {-69, -65, -63, -66}, {-75, -72, -89, -63}, {-64, -68, -71, -69}, {-64, -51, -72, -73}, {-75, -74, -80, -63}, {-67, -67, -73, -71}, {-66, -67, -71, -70}, {-70, -62, -60, -58}, {-69, -80, -80, -89}, {-66, -81, -80, -83}, {-70, -64, -62, -72}, {-71, -62, -62, -58}, {-66, -67, -71, -69}, {-82, -70, -66, -75}, {-75, -73, -78, -63}, {-66, -60, -70, -64}, {-70, -77, -90, -88}, {-74, -65, -63, -74}, {-84, -61, -73, -66}, {-67, -65, -63, -72}, {-74, -72, -65, -68}, {-67, -64, -67, -78}, {-71, -64, -63, -66}, {-70, -75, -84, -92}, {-69, -63, -61, -74}, {-73, -65, -77, -63}, {-67, -63, -68, -80}, {-65, -67, -73, -70}, {-73, -65, -80, -63}, {-63, -50, -71, -76}, {-84, -67, -50, -79}, {-69, -64, -63, -71}, {-65, -49, -72, -74}};
        int[] y = {8, 1, 1, 5, 8, 5, 2, 8, 4, 5, 8, 0, 8, 0, 4, 7, 1, 1, 8, 8, 7, 0, 3, 5, 2, 2, 8, 1, 2, 3, 4, 3, 8, 1, 6, 2, 2, 4, 3, 4, 6, 5, 0, 2, 1, 1, 0, 3, 1, 7, 6, 3, 0, 7, 3, 1, 8, 1, 2, 4, 1, 2, 1, 6, 4, 3, 5, 2, 3, 7, 0, 8, 5, 6, 5, 4, 2, 0, 5, 7, 5, 6, 2, 1, 2, 2, 1, 0, 3, 6, 2, 6, 6, 0, 3, 7, 2, 8, 5, 5, 3, 8, 3, 1, 8, 6, 4, 6, 2, 0, 5, 8, 4, 5, 6, 3, 4, 3, 1, 1, 3, 1, 0, 7, 0, 7, 2, 7, 1, 5, 2, 2, 4, 6, 1, 7, 3, 5, 1, 8, 0, 7, 2, 1, 8, 7, 6, 6, 3, 1, 1, 7, 4, 1, 6, 3, 1, 8, 7, 2, 0, 8, 0, 7, 5, 8, 6, 7, 0, 7, 8, 4, 7, 0, 4, 7, 8, 5, 7, 0, 3, 8, 0, 7, 7, 2, 7, 0, 1, 4, 6, 1, 4, 1, 3, 1, 8, 8, 0, 0, 3, 3, 3, 2, 5, 6, 7, 6, 2, 0, 3, 5, 5, 5, 7, 1, 8, 7, 4, 6, 5, 2, 5, 4, 7, 6, 7, 6, 6, 1, 2, 5, 8, 4, 5, 4, 5, 8, 7, 5, 8, 8, 3, 4, 3, 1, 5, 5, 7, 0, 0, 2, 5, 7, 8, 6, 1, 7, 0, 4, 3, 5, 0, 3, 7, 0, 5, 5, 0, 3, 4, 7, 3, 2, 7, 3, 3, 7, 0, 0, 4, 7, 3, 6, 7, 1, 0, 4, 1, 4, 1, 5, 4, 0, 4, 4, 5, 3, 4, 2, 6, 4, 2};
        KNeighborsClassifier clf = new KNeighborsClassifier(9, 9, 2, X, y);
        return clf;
    }

    private int nNeighbors;
    private int nTemplates;
    private int nClasses;
    private double power;
    private double[][] X;
    private int[] y;

    private KNeighborsClassifier(int nNeighbors, int nClasses, double power, double[][] X, int[] y) {
        this.nNeighbors = nNeighbors;
        this.nTemplates = y.length;
        this.nClasses = nClasses;
        this.power = power;
        this.X = X;
        this.y = y;
    }

    private static class Neighbor {
        Integer clazz;
        Double dist;
        public Neighbor(int clazz, double dist) {
            this.clazz = clazz;
            this.dist = dist;
        }
    }



    private static double compute(double[] temp, double[] cand, double q) {
        double dist = 0.;
        double diff;
        for (int i = 0, l = temp.length; i < l; i++) {
            diff = Math.abs(temp[i] - cand[i]);
            if (q==1) {
                dist += diff;
            } else if (q==2) {
                dist += diff*diff;
            } else if (q==Double.POSITIVE_INFINITY) {
                if (diff > dist) {
                    dist = diff;
                }
            } else {
                dist += Math.pow(diff, q);
            }
        }
        if (q==1 || q==Double.POSITIVE_INFINITY) {
            return dist;
        } else if (q==2) {
            return Math.sqrt(dist);
        } else {
            return Math.pow(dist, 1. / q);
        }
    }

    public Integer predict(double[] features) {
        int classIdx = 0;
        if (this.nNeighbors == 1) {
            double minDist = Double.POSITIVE_INFINITY;
            double curDist;
            for (int i = 0; i < this.nTemplates; i++) {
                curDist = KNeighborsClassifier.compute(this.X[i], features, this.power);
                if (curDist <= minDist) {
                    minDist = curDist;
                    classIdx = y[i];
                }
            }
        } else {
            int[] classes = new int[this.nClasses];
            ArrayList<Neighbor> dists = new ArrayList<Neighbor>();
            for (int i = 0; i < this.nTemplates; i++) {
                dists.add(new Neighbor(y[i], KNeighborsClassifier.compute(this.X[i], features, this.power)));
            }
            Collections.sort(dists, new Comparator<Neighbor>() {
                @Override
                public int compare(Neighbor n1, Neighbor n2) {
                    return n1.dist.compareTo(n2.dist);
                }
            });
            for (Neighbor neighbor : dists.subList(0, this.nNeighbors)) {
                classes[neighbor.clazz]++;
            }
            for (int i = 0; i < this.nClasses; i++) {
                classIdx = classes[i] > classes[classIdx] ? i : classIdx;
            }
        }
        return classIdx;
    }
}
